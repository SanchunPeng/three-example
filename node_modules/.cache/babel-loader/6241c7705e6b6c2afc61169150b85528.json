{"ast":null,"code":"var _jsxFileName = \"/Users/a58/dev/car-test/src/components/DisplayCar.js\";\nimport React, { Component } from 'react';\nimport createRender from '../utils/createRender';\nimport objcontrol from '../controls/objcontrol';\nconst THREE = window.THREE;\nexport default class DisplayCar extends Component {\n  constructor(props) {\n    super(props);\n\n    this.changeCarMaterial = () => {};\n\n    this.createCarObj = () => {\n      const _this = this;\n\n      const loader = new THREE.OBJLoader2(null, {\n        enabled: false,\n        debug: false\n      });\n\n      const objLoadedBack = function (obj) {\n        // console.log(obj.detail.loaderRootNode.children[0])\n        const object = obj.detail.loaderRootNode;\n        object.name = 'car';\n\n        _this.scene.add(object);\n      };\n\n      const mtlLoadedBack = function (materials) {\n        // loader.setModelName('car');\n        loader.setMaterials(materials); // loader.setLogging( true, true );\n        // 开始加载 obj\n\n        loader.load(require('../objs/car1/file.obj'), objLoadedBack, null, null, null, false);\n      };\n\n      loader.loadMtl(require('../objs/car1/file.mtl'), null, mtlLoadedBack);\n    };\n\n    this.createCarObj2 = () => {\n      const _this = this;\n\n      const loader = new THREE.OBJLoader2(null, {\n        enabled: false,\n        debug: false\n      });\n\n      const objLoadedBack = function (obj) {\n        console.log(obj.detail.loaderRootNode.children[0].material.color);\n        obj.detail.loaderRootNode.children[0].material.color = new THREE.Color(0xff0000);\n\n        _this.scene.add(obj.detail.loaderRootNode);\n      };\n\n      loader.setModelName('car');\n      loader.load(require('../objs/car1/file.obj'), objLoadedBack, null, null, null, false);\n    };\n\n    this.initScene = () => {\n      const _this = this;\n\n      const _this$nextProps = this.nextProps,\n            fullWidth = _this$nextProps.fullWidth,\n            fullHeight = _this$nextProps.fullHeight;\n      const container = this.container = document.getElementById('car-show');\n      const renderer = this.renderer = createRender({\n        fullWidth,\n        fullHeight\n      });\n      const scene = this.scene = new THREE.Scene();\n      const camera = this.camera = this.createCamera(fullWidth, fullHeight);\n      this.scene.add(camera);\n      container.appendChild(this.renderer.domElement); // 添加环境光与平行光\n\n      const ambientLight = new THREE.AmbientLight(0x404040);\n      const directionalLight1 = new THREE.DirectionalLight(0xC0C090);\n      const directionalLight2 = new THREE.DirectionalLight(0xC0C090);\n      directionalLight1.position.set(-100, -50, 100);\n      directionalLight2.position.set(100, 50, -100);\n      this.scene.add(directionalLight1);\n      this.scene.add(directionalLight2);\n      this.scene.add(ambientLight); // 添加调试网格\n\n      const helper = new THREE.GridHelper(1200, 60, 0xFF4444, 0x404040);\n      this.scene.add(helper);\n      animation();\n\n      function animation() {\n        requestAnimationFrame(animation);\n        renderer.render(scene, camera);\n\n        _this.controls.update();\n      }\n\n      this.createCarObj();\n    };\n\n    this.createCamera = (width, height) => {\n      const camera = new THREE.PerspectiveCamera(50, 1, 0.5, 100000);\n      camera.name = 'camera';\n      camera.width = width;\n      camera.height = height;\n      camera.aspect = width / height;\n      camera.lookAt(new THREE.Vector3(0, 0, 0));\n      camera.position.set(0.0, 175.0, 500.0);\n      camera.updateProjectionMatrix();\n      this.controls = objcontrol(camera, this.renderer.domElement);\n      return camera;\n    };\n\n    this.state = {};\n  }\n\n  componentWillReceiveProps(nextProps) {\n    this.nextProps = nextProps;\n\n    if (nextProps.fullWidth !== this.props.fullWidth) {\n      this.initScene();\n    }\n\n    if (nextProps.currentColor !== this.props.currentColor && nextProps.currentColor !== '') {\n      this.changeCarMaterial(nextProps.currentColor);\n    }\n  }\n\n  componentDidMount() {\n    window.displaycars = this;\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      id: \"car-show\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125\n      },\n      __self: this\n    });\n  }\n\n}","map":{"version":3,"sources":["/Users/a58/dev/car-test/src/components/DisplayCar.js"],"names":["React","Component","createRender","objcontrol","THREE","window","DisplayCar","constructor","props","changeCarMaterial","createCarObj","_this","loader","OBJLoader2","enabled","debug","objLoadedBack","obj","object","detail","loaderRootNode","name","scene","add","mtlLoadedBack","materials","setMaterials","load","require","loadMtl","createCarObj2","console","log","children","material","color","Color","setModelName","initScene","nextProps","fullWidth","fullHeight","container","document","getElementById","renderer","Scene","camera","createCamera","appendChild","domElement","ambientLight","AmbientLight","directionalLight1","DirectionalLight","directionalLight2","position","set","helper","GridHelper","animation","requestAnimationFrame","render","controls","update","width","height","PerspectiveCamera","aspect","lookAt","Vector3","updateProjectionMatrix","state","componentWillReceiveProps","currentColor","componentDidMount","displaycars"],"mappings":"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","sourcesContent":["import React, {Component} from 'react'\nimport createRender from '../utils/createRender'\nimport objcontrol from '../controls/objcontrol';\nconst THREE = window.THREE\n\n\nexport default class DisplayCar extends Component{\n    scene\n    container\n    camera\n    renderer\n    controls\n    constructor(props) {\n       super(props);\n       this.state = {\n\n       }\n    }\n\n    componentWillReceiveProps(nextProps) {\n        this.nextProps = nextProps\n\n        if (nextProps.fullWidth !== this.props.fullWidth) {\n            this.initScene()\n        }\n        if (nextProps.currentColor !== this.props.currentColor && nextProps.currentColor !== '') {\n            this.changeCarMaterial(nextProps.currentColor)\n        }\n    }\n\n    changeCarMaterial = () => {\n        \n    }\n\n\n    createCarObj = () => {\n        const _this = this\n\n        const loader = new THREE.OBJLoader2(null, {enabled: false, debug: false})\n        const objLoadedBack = function (obj) {\n            // console.log(obj.detail.loaderRootNode.children[0])\n            const object = obj.detail.loaderRootNode\n            object.name = 'car'\n            _this.scene.add( object );\n        }\n        const mtlLoadedBack = function (materials) {\n            // loader.setModelName('car');\n            loader.setMaterials( materials );\n            // loader.setLogging( true, true );\n            // 开始加载 obj\n            loader.load( require('../objs/car1/file.obj'), objLoadedBack, null, null, null, false );\n        }\n        loader.loadMtl( require('../objs/car1/file.mtl'), null, mtlLoadedBack );\n    }\n\n    createCarObj2 = () => {\n        const _this = this\n\n        const loader = new THREE.OBJLoader2(null, {enabled: false, debug: false})\n        const objLoadedBack = function (obj) {\n            console.log(obj.detail.loaderRootNode.children[0].material.color)\n            obj.detail.loaderRootNode.children[0].material.color =  new THREE.Color( 0xff0000 )\n            _this.scene.add( obj.detail.loaderRootNode );\n        }\n        loader.setModelName('car');\n        loader.load( require('../objs/car1/file.obj'), objLoadedBack, null, null, null, false );\n\n    }\n\n    initScene = () => {\n        const _this = this\n        const {fullWidth, fullHeight} = this.nextProps\n        const container = this.container = document.getElementById('car-show')\n        const renderer = this.renderer = createRender({fullWidth, fullHeight})\n        const scene = this.scene = new THREE.Scene()\n        const camera = this.camera = this.createCamera(fullWidth, fullHeight)\n        this.scene.add(camera)\n        container.appendChild(this.renderer.domElement)\n\n        // 添加环境光与平行光\n        const ambientLight = new THREE.AmbientLight( 0x404040 );\n        const directionalLight1 = new THREE.DirectionalLight( 0xC0C090 );\n        const directionalLight2 = new THREE.DirectionalLight( 0xC0C090 );\n\n        directionalLight1.position.set( -100, -50, 100 );\n        directionalLight2.position.set( 100, 50, -100 );\n\n        this.scene.add( directionalLight1 );\n        this.scene.add( directionalLight2 );\n        this.scene.add( ambientLight );\n        // 添加调试网格\n        const helper = new THREE.GridHelper( 1200, 60, 0xFF4444, 0x404040 );\n        this.scene.add( helper );\n\n        animation()\n        function animation () {\n            requestAnimationFrame(animation)\n            renderer.render(scene, camera)\n            _this.controls.update();\n        }\n\n        this.createCarObj()\n\n    }\n\n    createCamera = (width, height) => {\n        const camera = new THREE.PerspectiveCamera( 50, 1, 0.5, 100000 )\n        camera.name = 'camera'\n        camera.width = width\n        camera.height = height\n        camera.aspect = width/height\n        camera.lookAt(new THREE.Vector3(0, 0, 0))\n        camera.position.set(0.0, 175.0, 500.0)\n        camera.updateProjectionMatrix();\n        this.controls = objcontrol(camera, this.renderer.domElement)\n        return camera\n    }\n\n    componentDidMount() {\n        window.displaycars = this\n\n    }\n\n    render() {\n        return <div id=\"car-show\">\n        </div>\n    }\n\n}"]},"metadata":{},"sourceType":"module"}